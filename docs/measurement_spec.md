# Mark & Weld 测量工具交互规范说明书 (v1.0)

## 1. 核心数学体系 (System Core)
*   **归一化投影 (Normalized Projection)**: 所有点位必须以 `0-1` 的百分比坐标存储，计算时通过 `layoutSize` (Sub-pixel 亚像素精度) 还原至画布像素，再通过 `mmPerPixel` 转换为物理尺寸。
*   **吸附系统 (Snapping)**: 
    *   **半径**: 12px (屏幕空间)。
    *   **目标**: 校准点、测量端点、当前正在绘制的点。
    *   **视觉反馈**: 绿色脉冲圆圈 (`#22c55e`)。

## 2. 交互模式详解 (Interaction Modes)

### 2.1 Manual Calibrate (手动标定)
*   **Mode**: `calibrate`
*   **步骤**: 
    1.  点击 P1，确立起点。
    2.  移动鼠标：显示 **黄色虚线** (`#fbbf24`) 连接 P1 与光标，**预览状态下需实时显示当前物理长度**。
    3.  点击 P2，弹出 `PromptModal`。
*   **结算**: 输入距离后，更新全局 `calibrationData`，模式自动跳转至 `measure`。

### 2.2 Distance (长度测量)
*   **Mode**: `measure`
*   **步骤**: 
    1.  点击 P1。
    2.  移动鼠标：显示 **蓝色虚线** (`#6366f1`) 连线，并在中点 **实时显示预览长度**。即使未点击 Confirm，预览效果也应与完成后的线条一致。
    3.  点击 P2。
*   **渲染**: 靛蓝色实线 (`#6366f1`)，带白色描边文字。

### 2.3 Parallel (平行距离/垂线)
*   **Mode**: `parallel`
*   **步骤**: 
    1.  点击 P1, P2：定义 **基准线** (Base Line)。
    2.  移动鼠标：从光标向基准线投射 **垂直辅助线** (Yellow Dashed)，**实时显示垂线距离 D**。
    3.  点击 P3：确认偏移量。**即使未点击 Confirm，预览状态也必须显示 D 值和辅助线**。
*   **渲染**: 靛蓝基准线 + 黄色虚化垂线 + "D: [val]mm" 标签。

### 2.4 Area (多边形面积)
*   **Mode**: `area`
*   **步骤**: 
    1.  依次点击 P1, P2...Pn。
    2.  移动鼠标：实时显示 **闭合填充区域** (15% 蓝色透明度) 以及闭合路径预览。
    3.  **数值预览**: 在多边形重心位置 **实时显示当前闭合区域的面积**，不随 Confirm 按钮状态改变。
*   **渲染**: 靛蓝边框 + 浅色填充 + 重心位置显示面积数值。

### 2.5 Curve (曲线/周长)
*   **Mode**: `curve`
*   **步骤**: 
    1.  依次点击 P1, P2...Pn。
    2.  预览：采用 **Catmull-Rom Spline** 算法生成平滑曲线预览，**实时显示当前累计路径的总长度**。
    3.  **确认**: 点击“Confirm”或按 `Enter`。
*   **渲染**: 紫色虚线分段曲线 (`#a855f7`)。

### 2.6 Set Origin (原点设置)
*   **Mode**: `origin`
*   **交互**: 单击任意位置。
*   **视觉**: 红色瞄准准星 (`#f43f5e`)，由大圆、细十字线组成。
*   **逻辑**: 之后所有顶部 Dashboard 显示的 X/Y 坐标均为相对于该点的偏移量。

### 2.7 Manual Weld Point (手动焊点设置)
*   **Mode**: `manual_weld`
*   **交互**: 单击图像任意位置创建点位。支持方向键微调。
*   **视觉**: 翡翠绿 (`#10b981`) 十字准星与呼吸光圈。
*   **结算**: 弹出名称输入框，保存为带有 `isWeld` 标签的特征组。

## 3. 辅助交互逻辑 (Auxiliary Logic)

### 3.1 实时预览 (Dynamic Preview)
*   所有处于“待定状态”的点（已点击但未完成形状）必须在 `ImageCanvas.tsx` 中实时渲染预览线。
*   **核心原则**: **预览状态的视觉表现（包括线条、颜色、物理数值标签）必须与点击“Confirm”后的正式渲染保持高度一致。**
*   **颜色规范**: 
    *   标定辅助：`#fbbf24` (Amber-400)
    *   通用测量：`#6366f1` (Indigo-500)
    *   曲线工具：`#a855f7` (Purple-500)
    *   手动焊点：`#10b981` (Emerald-500)

### 3.2 键盘微调 (Keyboard Nudge)
*   **方向键**: 移动最后点击的一个点位。
*   **Shift + 方向键**: 10倍步长移动。
*   **步长单位**: 基于 `mmPerPx`，默认单次按键移动 0.01mm（若已标定）或 1px（未标定）。
